{"version":3,"file":"13.DB1zv1z3.js","sources":["../../../../../../src/routes/write/+page.ts","../../../../../../src/routes/write/+page.svelte"],"sourcesContent":["import { dev } from '$app/environment';\n\n// we don't need any JS on this page, though we'll load\n// it in dev so that we get hot module replacement\nexport const csr = dev;\n\n// since there's no dynamic data here, we can prerender\n// it so that it gets served as a static asset in production\nexport const prerender = true;\n","<script lang=\"ts\">\n\timport { onMount } from 'svelte';\n\timport { Vault, COUPON_SERIES, VAULT_SERIES } from '@fbch/lib';\n\timport { height } from '$lib/store.js';\n\n\timport { copy } from 'svelte-copy';\n\timport { toast } from '@zerodevx/svelte-toast';\n\n\tlet s = 4;\n\tlet c = 0;\n\tlet coupons = [];\n\tlet copyText = '';\n\tlet duplicateCoupons = 1;\n\n\tlet rate = 20;\n\tlet totalSpend = 0;\n\tlet totalPlacement = 0;\n\tlet heightValue = 857000;\n\n\theight.subscribe((value: any) => {\n\t\theightValue = value;\n\t});\n\n\tfunction getSendToMany(coupons): string {\n\t\tlet str = coupons\n\t\t\t.map((c) => {\n\t\t\t\treturn `${c.address}, ${c.amount}`;\n\t\t\t})\n\t\t\t.join('\\r\\n');\n\t\treturn str;\n\t}\n\n\tfunction updateCoupons() {\n\t\tlet placement = Math.round((10 ** c + Number.EPSILON) * 100) / 100;\n\t\tlet addresses = Vault.getCouponSeries(heightValue, placement * 1e8, s, s == 6 ? 4 : undefined);\n\t\tlet times = Vault.getSeriesTimes(heightValue, s, s == 6 ? 4 : undefined);\n\n\t\tcoupons = addresses\n\t\t\t.map(function (a, i) {\n\t\t\t\tif ((times[i] - heightValue) * rate > 543) {\n\t\t\t\t\treturn [\n\t\t\t\t\t\t...Array(duplicateCoupons).fill({\n\t\t\t\t\t\t\ttime: times[i],\n\t\t\t\t\t\t\taddress: a,\n\t\t\t\t\t\t\tplacement: placement,\n\t\t\t\t\t\t\tamount: Math.floor((times[0] - heightValue) * rate * placement) / 1e8\n\t\t\t\t\t\t})\n\t\t\t\t\t];\n\t\t\t\t} else {\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\t\t\t})\n\t\t\t.flat();\n\n\t\tcopyText = getSendToMany(coupons);\n\t\ttotalPlacement = coupons.reduce(function (acc, obj) {\n\t\t\treturn acc + obj.placement;\n\t\t}, 0);\n\t\ttotalPlacement = Math.round(totalPlacement * 100) / 100;\n\t\ttotalSpend = coupons.reduce(function (acc, obj) {\n\t\t\treturn acc + obj.amount;\n\t\t}, 0);\n\t\ttotalSpend = Math.floor(totalSpend * 1e8) / 1e8;\n\t}\n\n\tonMount(async () => {\n\t\tupdateCoupons();\n\t});\n</script>\n\n<svelte:head>\n\t<title>Write</title>\n\t<meta name=\"description\" content=\"Write Coupons\" />\n</svelte:head>\n\n<div class=\"text-column\">\n\t<h1>Let's write some coupons!</h1>\n\t<blockquote>\n\t\t<b>This is an advanced feature for power users. There is no way to undo writing a coupon.</b>\n\t</blockquote>\n\t<p>\n\t\tCoupons incentivize money being spent 1) at a specific destination, 2) above some minimum\n\t\tamount, and 3) with restrictions like: limit one per customer.\n\t</p>\n\t<p>\n\t\tFuture vault coupons are plain bitcoin cash unspent transaction outputs (UTXOs) that have been\n\t\tsent to, and are then locked by a <a href=\"/contracts#coupon\">simple contract</a> to incentivize\n\t\tspending money at a specific destination (a FBCH token vault). For example, an output of 100k sats\n\t\tcan be sent to a coupon contract to be used for locking at least 1 BCH (min. value) into 1 FBCH at\n\t\ta vault contract (destination).\n\t</p>\n\t<p>\n\t\tCoupons values are denoted in BCH sats, where the value of the coupon is the value of the\n\t\tunspent output. A whole BCH could be split into 1000 coupons each offering 100k sats for\n\t\tplacement, or 1 BCH coin could be sent to the coupon contract in one single output to let anyone\n\t\tlock a \"free\" FBCH.\n\t</p>\n\t<p>\n\t\tThese \"C<sub>0</sub>\" series coupons are to lock 1 x 10^0 BCH, but there are\n\t\tsmaller and larger amounts (i.e C<sub>1</sub> for 10 BCH placements and C<sub>-1</sub> for\n\t\t0.1 BCH vault placements).\n\t</p>\n\t<p>\n\t\t<b>Coupons are not refundable.</b>\n\t\tMoney sent to a coupon holding contract can only be redeemed in a transaction that sends the required\n\t\tamount of value to a second predefined contract (i.e. a future vault).\n\t</p>\n\t<p>\n\t\tBelow is a simple tool for use with the <a href=\"https://electroncash.org/\">Electron Cash</a> pay-to-many\n\t\tfeature:\n\t</p>\n\n\t<div id=\"control\">\n\t\t<div>\n\t\t\tPlacement: <br />\n\n\t\t\t{#each COUPON_SERIES as order}\n\t\t\t\t<label>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\t\tname=\"c\"\n\t\t\t\t\t\tvalue={order}\n\t\t\t\t\t\tbind:group={c}\n\t\t\t\t\t\ton:change={() => updateCoupons()}\n\t\t\t\t\t/>\n\t\t\t\t\tC<sub>{order}</sub> Series - {Math.pow(10, order).toLocaleString()} BCH <br />\n\t\t\t\t</label>\n\t\t\t{/each}\n\t\t</div>\n\t\t<div>\n\t\t\t<label>\n\t\t\t\tRate: {rate} spb , <i>~{(rate / 20.0).toPrecision(2)}% </i><br />\n\t\t\t\t<input\n\t\t\t\t\ttype=\"range\"\n\t\t\t\t\ton:change={() => updateCoupons()}\n\t\t\t\t\tbind:value={rate}\n\t\t\t\t\tmin=\"1\"\n\t\t\t\t\tstep=\"0.2\"\n\t\t\t\t\tmax=\"100\"\n\t\t\t\t/>\n\t\t\t</label>\n\t\t</div>\n\t\t<div>\n\t\t\t<label>\n\t\t\t\tCopies: {duplicateCoupons}<br />\n\t\t\t\t<input\n\t\t\t\t\ttype=\"range\"\n\t\t\t\t\ton:change={() => updateCoupons()}\n\t\t\t\t\tbind:value={duplicateCoupons}\n\t\t\t\t\tmin=\"1\"\n\t\t\t\t\tmax=\"40\"\n\t\t\t\t/>\n\t\t\t</label>\n\t\t</div>\n\n\t\t<div id=\"dataTable\">\n\t\t\t{#each VAULT_SERIES as number}\n\t\t\t\t<label>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"radio\"\n\t\t\t\t\t\tname=\"s\"\n\t\t\t\t\t\tvalue={number}\n\t\t\t\t\t\tbind:group={s}\n\t\t\t\t\t\ton:change={() => updateCoupons()}\n\t\t\t\t\t/>\n\t\t\t\t\tV{number} Series - {Math.pow(10, number).toLocaleString()} <br />\n\t\t\t\t</label>\n\t\t\t{/each}\n\t\t</div>\n\t</div>\n\n\t<div>\n\t\tLock up to {totalPlacement} FBCH\n\t</div>\n\t<div id=\"total\">\n\t\tTotal: {totalSpend} BCH<br />\n\t</div>\n\t<hr />\n\n\t<div\n\t\tid=\"mono\"\n\t\tuse:copy={copyText}\n\t\ton:svelte-copy={(event) => toast.push('Coupons copied to clipboard')}\n\t\ton:svelte-copy:error={(event) =>\n\t\t\ttoast.push(`Error, no access to clipboard?: ${event.detail.message}`, {\n\t\t\t\tclasses: ['warn']\n\t\t\t})}\n\t>\n\t\t{#each coupons as c}\n\t\t\t{c.address}, {c.amount}<br />\n\t\t{/each}\n\t</div>\n</div>\n\n<style>\n\t#control {\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t}\n\t#control div {\n\t\tflex: 1 0 50%;\n\t\tborder: 1px solid black;\n\t\tpadding: 0.2em;\n\t}\n\t#mono {\n\t\tfont-family: monospace;\n\t\tword-break: break-all;\n\t}\n\t#dataTable {\n\t\tmax-width: fit-content;\n\t}\n\t#total {\n\t\ttext-align: right;\n\t}\n</style>\n"],"names":["csr","dev","prerender","t3_value","ctx","insert_hydration","target","label","anchor","append_hydration","input","sub","br","t0_value","t2_value","dirty","set_data","t0","t2","t35_value","COUPON_SERIES","i","VAULT_SERIES","meta","div8","h1","blockquote","p0","p1","p2","p3","p4","p5","div4","div0","br0","div1","label0","br1","input0","div2","label1","br2","input1","div3","div5","div6","br3","hr","div7","t35","getSendToMany","coupons","c","s","copyText","duplicateCoupons","rate","totalSpend","totalPlacement","heightValue","height","value","updateCoupons","placement","addresses","Vault","times","$$invalidate","a","acc","obj","onMount","to_number","event","toast"],"mappings":"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"}
{"version":3,"file":"8.m2wtUVAV.js","sources":["../../../../../../src/routes/v/+page.ts","../../../../../../src/routes/v/+page.svelte"],"sourcesContent":["export const prerender = true;\n\n","<script lang=\"ts\">\n\timport { page } from '$app/stores';\n\timport { onMount } from 'svelte';\n\timport { getFutureBlockDate, Vault } from '@fbch/lib';\n\timport SeriesIcon from '$lib/images/SeriesIcon.svelte';\n\timport { height } from '$lib/store.js';\n\timport { ElectrumClient, ElectrumTransport } from '@electrum-cash/network';\n\n\texport let data: any;\n\tlet couponAddress: string;\n\tlet vaultAddress: string;\n\n\t//@ts-ignore\n\tlet coupons;\n\t//@ts-ignore\n\tlet threads;\n\n\tlet block; \n\n\tlet time: number;\n\n\tlet heightValue: number;\n\n\theight.subscribe((value: any) => {\n\t\theightValue = value;\n\t});\n\n\t// Set up a callback function to handle new blocks.\n\tconst handleNotifications = function (data: any) {\n\t\tconsole.log('electrum: ', data);\n\t};\n\n\tonMount(async () => {\n\n\t\tblock = $page.url.searchParams.get('block') || undefined;\n\t\ttime = Number(block);\n\t\tcouponAddress = Vault.getCoupon(1e8, time);\n\t\tvaultAddress = Vault.getAddress(time);\n\n\t\t// Initialize an electrum client.\n\t\tconst electrum = new ElectrumClient(\n\t\t\t'FBCH',\n\t\t\t'1.4.1',\n\t\t\t'bch.imaginary.cash',\n\t\t\tElectrumTransport.WSS.Port,\n\t\t\tElectrumTransport.WSS.Scheme\n\t\t);\n\n\t\t// Wait for the client to connect\n\t\tawait electrum.connect();\n\t\t// Listen for notifications.\n\t\telectrum.on('notification', handleNotifications);\n\n\t\tawait electrum.subscribe('blockchain.address.subscribe', couponAddress);\n\t\tawait electrum.subscribe('blockchain.address.subscribe', vaultAddress);\n\t\tconst vaultResponse = await electrum.request(\n\t\t\t'blockchain.address.listunspent',\n\t\t\tvaultAddress,\n\t\t\t'tokens_only'\n\t\t);\n\t\tif (vaultResponse instanceof Error) throw vaultResponse;\n\t\tthreads = vaultResponse;\n\t\tconst couponResponse = await electrum.request('blockchain.address.listunspent', couponAddress);\n\t\tif (couponResponse instanceof Error) throw couponResponse;\n\t\tcoupons = couponResponse;\n\t\t// @ts-ignore\n\t\tif (coupons.length > 0) coupons.sort((a, b) => parseFloat(b.value) - parseFloat(a.value));\n\t});\n</script>\n\n<svelte:head>\n\t<title>FBCH-{time}</title>\n\t<meta name=\"description\" content=\"Future Vault Series\" />\n\t{#if time > 857000}\n\t\t<link rel=\"icon\" type=\"image/svg\" href=\"/FBCH-{time}.svg\" />\n\t{/if}\n</svelte:head>\n\n<section>\n\t{#if time}\n\t\t<h1>Vault {time.toLocaleString()}</h1>\n\t\t<SeriesIcon {time} size=\"150\" />\n\n\t\t{#if heightValue}\n\t\t\t{#if time - heightValue > 0}\n\t\t\t\t<h2>T&#8196; -{(time - heightValue).toLocaleString()}&#8196;â– </h2>\n\t\t\t{/if}\n\t\t\t<h3>\n\t\t\t\tUnlocks around\n\t\t\t\t{getFutureBlockDate(heightValue, time).toLocaleDateString()}\n\t\t\t\t{#if time - heightValue < 2000}\n\t\t\t\t\t{getFutureBlockDate(heightValue, time).toLocaleTimeString()}\n\t\t\t\t{/if}\n\t\t\t</h3>\n\t\t{/if}\n\n\t\t<h4>Coupons</h4>\n\t\t{#if coupons}\n\t\t\t{#if coupons.length > 0}\n\t\t\t\t<table class=\"couponTable\">\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<tr class=\"header\">\n\t\t\t\t\t\t\t<td>Series</td>\n\t\t\t\t\t\t\t<td>Placement </td>\n\t\t\t\t\t\t\t<td>Coupon </td>\n\t\t\t\t\t\t\t<td>spb </td>\n\t\t\t\t\t\t\t<td>apr* </td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\n\t\t\t\t\t<tbody>\n\t\t\t\t\t\t{#each coupons as c}\n\t\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t\t<td>C<sub>0</sub></td>\n\t\t\t\t\t\t\t\t<td>1 BCH</td>\n\t\t\t\t\t\t\t\t<td class=\"r\">{c.value.toLocaleString()} </td>\n\t\t\t\t\t\t\t\t<td class=\"r\">{(c.value / (time - heightValue)).toFixed(1)}</td>\n\t\t\t\t\t\t\t\t<td class=\"r\"\n\t\t\t\t\t\t\t\t\t><i>{(c.value / (time - heightValue) / (1e6 / 52596)).toFixed(2)}%</i></td\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t{:else}\n\t\t\t\t<p>no coupons available</p>\n\t\t\t{/if}\n\t\t{:else}\n\t\t\t<p>loading coupons...</p>\n\t\t{/if}\n\t\t<h4>Vault Threads</h4>\n\n\t\t{#if threads && threads.length}\n\t\t\t<table class=\"couponTable\">\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>Token Id </td>\n\t\t\t\t\t\t<td>BCH </td>\n\t\t\t\t\t\t<td>FBCH-{time} </td>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\n\t\t\t\t<tbody>\n\t\t\t\t\t{#each threads as c}\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td \n\t\t\t\t\t\t\t\t><i\n\t\t\t\t\t\t\t\t\t>{c.token_data.category.substring(0, 8) +\n\t\t\t\t\t\t\t\t\t\t'...' +\n\t\t\t\t\t\t\t\t\t\tc.token_data.category.slice(-8)}</i\n\t\t\t\t\t\t\t\t></td\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<td class=\"r\">{(c.value / 1e8).toFixed(2)} </td>\n\t\t\t\t\t\t\t<td class=\"r\"><i>{(c.token_data.amount / 1e8).toLocaleString()}</i></td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t{/each}\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t{:else}\n\t\t\t<p>loading threads...</p>\n\t\t{/if}\n\t\t{:else}\n\t\t<p>loading...</p>\n\t{/if}\n</section>\n\n<style>\n\tp {\n\t\ttext-overflow: ellipsis;\n\t}\n\n\t\n\t.couponTable {\n\t\twidth: 100%;\n\t}\n\tthead tr {\n\t\ttext-align: center;\n\t\tfont-weight: 900;\n\t}\n\ttbody tr:nth-child(odd) {\n\t\tbackground-color: #ff33cc1f;\n\t}\n\n\t.r {\n\t\ttext-align: right;\n\t}\n\ttbody tr td {\n\t}\n\ttbody tr:nth-child(even) {\n\t\tbackground-color: #e495e41a;\n\t}\n</style>\n"],"names":["prerender","ctx","insert_hydration","target","link","anchor","p","t1_value","create_if_block_4","create_if_block_2","create_if_block_1","h1","h40","h41","current","dirty","set_data","t1","t2_value","getFutureBlockDate","create_if_block_6","create_if_block_5","h3","t2","h2","t_value","t","create_if_block_3","i","table","append_hydration","thead","tbody","t9_value","tr","td0","td1","td2","td3","td4","t5","t5_value","t7","t7_value","t9","t4_value","i0","i1","t0","t0_value","t4","if_block0","create_if_block_7","meta","section","data","$$props","couponAddress","vaultAddress","coupons","threads","block","time","heightValue","height","value","$$invalidate","handleNotifications","onMount","$page","Vault","electrum","ElectrumClient","ElectrumTransport","vaultResponse","couponResponse","a","b"],"mappings":"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"}
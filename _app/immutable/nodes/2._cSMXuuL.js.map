{"version":3,"file":"2._cSMXuuL.js","sources":["../../../../../../src/routes/+page.ts","../../../../../../src/routes/+page.svelte"],"sourcesContent":["// since there's no dynamic data here, we can prerender\n// it so that it gets served as a static asset in production\nexport const prerender = true;\n","<script lang=\"ts\">\n\timport { onMount } from 'svelte';\n\timport { height } from '$lib/store.js';\n\timport { ElectrumClient, ElectrumTransport } from '@electrum-cash/network';\n\timport { IndexedDBProvider } from '@mainnet-cash/indexeddb-storage';\n\timport { BaseWallet } from 'mainnet-js';\n\timport { type Utxo } from 'cashscript';\n\n\timport { toast } from '@zerodevx/svelte-toast';\n\n\timport { Vault } from '@fbch/lib';\n\timport bch from '$lib/images/bch.svg';\n\timport { CATEGORY_MAP, TIMELOCK_MAP } from '@fbch/lib';\n\timport { FutureWallet } from '@fbch/lib';\n\n\timport SeriesIcon from '$lib/images/SeriesIcon.svelte';\n\tlet errorMessage = '';\n\n\tlet heightValue: number;\n\tlet coupons: any[];\n\tlet requests: any[] = [];\n\tlet electrum: ElectrumClient;\n\n\tlet wallet: FutureWallet;\n\tlet walletBalance: number;\n\tlet walletError;\n\n\theight.subscribe((value: any) => {\n\t\tconsole.log(heightValue);\n\t\theightValue = value;\n\t\tupdateCoupons();\n\t});\n\n\tasync function updateCoupons() {\n\t\tif (electrum && heightValue > 1000)\n\t\t\tcoupons = await Vault.getAllCouponUtxos(electrum, heightValue);\n\t}\n\n\tfunction debounce(func, timeout = 2000) {\n\t\tlet timer;\n\t\treturn (...args) => {\n\t\t\tclearTimeout(timer);\n\t\t\ttimer = setTimeout(() => {\n\t\t\t\tfunc.apply(this, args);\n\t\t\t}, timeout);\n\t\t};\n\t}\n\n\tasync function doSwaps() {\n\t\tconsole.log('processing que data');\n\t\tconsole.log(requests)\n\t\ttry {\n\t\t\tawait wallet.swap(requests);\n\t\t\terrorMessage = '';\n\t\t} catch (e: Error) {\n\t\t\terrorMessage = e;\n\t\t\ttoast.push(`Error: ${e}`, {\n\t\t\t\tclasses: ['warn']\n\t\t\t});\n\t\t}\n\t\trequests = [];\n\t}\n\n\tconst processQueue = debounce(() => doSwaps());\n\n\tconst handlePlacement = async function (coupon: any, id:string) {\n\t\twalletBalance -= coupon.placement;\n\t\trequests.push({\n\t\t\tplacement: BigInt(coupon.placement),\n\t\t\tcoupon: coupon.utxo,\n\t\t\tlocktime: coupon.locktime\n\t\t});\n\t\tconsole.log(requests)\n\t\tcoupons = coupons.filter((c) => c.id !== id);\n\t\tprocessQueue();\n\t};\n\n\tonMount(async () => {\n\t\ttry {\n\t\t\tBaseWallet.StorageProvider = IndexedDBProvider;\n\t\t\twallet = await FutureWallet.named('hot');\n\t\t\twalletBalance = (await wallet.getBalance('sats')) as number;\n\t\t} catch (e) {\n\t\t\twalletError = true;\n\t\t\tthrow e;\n\t\t}\n\n\t\t// Initialize an electrum client.\n\t\telectrum = new ElectrumClient(\n\t\t\t'FBCH',\n\t\t\t'1.4.1',\n\t\t\t'bch.imaginary.cash',\n\t\t\tElectrumTransport.WSS.Port,\n\t\t\tElectrumTransport.WSS.Scheme\n\t\t);\n\t\tawait electrum.connect().then(() => {\n\t\t\t// Listen for notifications.\n\t\t\tupdateCoupons();\n\t\t});\n\t});\n</script>\n\n<svelte:head>\n\t<title>Future BCH</title>\n\t<meta name=\"description\" content=\"Future Bitcoin Cash\" />\n\t<link rel=\"icon\" type=\"image/svg\" href=\"/FBCH.svg\" />\n</svelte:head>\n\n<section>\n\t<p>\n\t\tFBCH are series of fungible tokens, with an incentive market for locking and unlocking Bitcoin\n\t\tCash.\n\t</p>\n\t{#if coupons}\n\t\t{#if coupons.length > 0}\n\t\t\t<table class=\"couponTable\">\n\t\t\t\t<thead>\n\t\t\t\t\t<tr class=\"header\">\n\t\t\t\t\t\t<td><i>P</i></td>\n\t\t\t\t\t\t<td>locktime</td>\n\t\t\t\t\t\t<td>coupon</td>\n\t\t\t\t\t\t<td colspan=\"2\">coupon rate </td>\n\t\t\t\t\t\t<td>action</td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr class=\"units\">\n\t\t\t\t\t\t<td>BCH</td>\n\t\t\t\t\t\t<td>series</td>\n\t\t\t\t\t\t<td class=\"r\">sats</td>\n\t\t\t\t\t\t<td class=\"r\">spb</td>\n\t\t\t\t\t\t<td>per annum</td>\n\t\t\t\t\t\t<td> </td>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\n\t\t\t\t<tbody>\n\t\t\t\t\t{#each coupons as c (c.id)}\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td class=\"r\"\n\t\t\t\t\t\t\t\t>{Number(c.placement / 1e8)}<img width=\"15\" src={bch} alt=\"bchLogo\" /></td\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<td class=\"r\"\n\t\t\t\t\t\t\t\t><a href=\"/v?block={c.locktime}\"\n\t\t\t\t\t\t\t\t\t>{c.locktime.toLocaleString()}<SeriesIcon time={c.locktime} size=\"15\" /></a\n\t\t\t\t\t\t\t\t></td\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<td class=\"sats\">{Number(c.utxo.satoshis).toLocaleString()} </td>\n\t\t\t\t\t\t\t<td class=\"sats\">{c.locale.spb}</td>\n\t\t\t\t\t\t\t<td class=\"r\">\n\t\t\t\t\t\t\t\t<i>{c.locale.ypa}%</i>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t{#if walletBalance + Number(c.utxo.satoshis) > c.placement}\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\"\n\t\t\t\t\t\t\t\t\t><button class=\"action\" on:click={() => handlePlacement(c, c.id)}>claim</button\n\t\t\t\t\t\t\t\t\t></td\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t<td style=\"text-align:center;\"\n\t\t\t\t\t\t\t\t\t><button class=\"action\" disabled style=\"font-size:x-small;\">low bal.</button></td\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t{/each}\n\t\t\t\t\t<!-- <tr style=\"border-top: solid thin;\">\n\t\t\t\t\t\t\t<td>âˆ‘</td>\n\t\t\t\t\t\t\t<td class=\"r\"><b>{openCouponInterest.toFixed(0)} </b></td>\n\t\t\t\t\t\t\t<td class=\"r\">\n\t\t\t\t\t\t\t\t<b>{couponTotal.toLocaleString()} </b>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td></td>\n\t\t\t\t\t\t\t<td></td>\n\t\t\t\t\t\t\t<td></td>\n\t\t\t\t\t\t</tr> -->\n\t\t\t\t</tbody>\n\t\t\t</table>\n\t\t{:else}\n\t\t\t<p>no coupons available</p>\n\t\t{/if}\n\t{:else}\n\t\t<p>loading coupons...</p>\n\t{/if}\n</section>\n\n<style>\n\tsection {\n\t\tdisplay: flex;\n\t\tflex-direction: column;\n\t\tflex: 0.6;\n\t}\n\n\th1 {\n\t\twidth: 100%;\n\t}\n\n\t.cashaddr {\n\t\tline-break: anywhere;\n\t}\n\t.couponTable {\n\t\twidth: 100%;\n\t\tborder-collapse: collapse;\n\t}\n\tthead tr td {\n\t\tborder: 2px ridge rgba(247, 202, 248, 0.6);\n\t\tbackground-color: #ffffff5b;\n\t}\n\n\tthead tr:nth-child(odd) {\n\t\ttext-align: center;\n\n\t\tfont-weight: 900;\n\t}\n\n\t.action {\n\t\tdisplay: inline-block;\n\t\tborder-radius: 10px;\n\t\tbackground-color: #fa1ad5;\n\t\tcolor: #fff;\n\t\tmargin: 1px;\n\t\tpadding: 0 10px 0 20px;\n\t\tfont-weight: 900;\n\t\tfont-size: small;\n\t}\n\n\t.action:disabled {\n\t\tdisplay: inline-block;\n\t\tborder-radius: 10px;\n\t\tbackground-color: #80748069;\n\t\tcolor: #ffffff;\n\t\tmargin: 1px;\n\t\tpadding: 0 10px 0 20px;\n\t\tfont-weight: 900;\n\t\tfont-size: small;\n\t}\n\n\t.units {\n\t\ttext-align: center;\n\t\tfont-style: italic;\n\t\tfont-weight: 200;\n\t}\n\ttbody tr:nth-child(odd) {\n\t\tbackground-color: #ff33cc1f;\n\t}\n\ttbody tr:nth-child(even) {\n\t\tbackground-color: #e495e41a;\n\t}\n\t.r {\n\t\ttext-align: right;\n\t}\n\t.sats {\n\t\ttext-align: right;\n\t\tfont-weight: 300;\n\t\tfont-style: italic;\n\t}\n\n\ttbody tr td {\n\t\tborder: 2px ridge rgba(247, 202, 248, 0.6);\n\t}\n</style>\n"],"names":["prerender","insert_hydration","target","p","anchor","ctx","get_key","i","table","append_hydration","thead","tbody","td","button","t0_value","t4_value","bch","attr","img","img_src_value","a","a_href_value","tr","td0","td1","td2","td3","td4","current","dirty","set_data","t0","t2","t2_value","seriesicon_changes","t4","t6","t6_value","t8","t8_value","meta","link","section","debounce","func","timeout","timer","args","errorMessage","heightValue","coupons","requests","electrum","wallet","walletBalance","height","value","updateCoupons","$$invalidate","Vault","doSwaps","e","toast","processQueue","handlePlacement","coupon","id","c","onMount","BaseWallet","IndexedDBProvider","FutureWallet","ElectrumClient","ElectrumTransport"],"mappings":"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"}
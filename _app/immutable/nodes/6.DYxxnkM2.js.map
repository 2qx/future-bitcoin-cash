{"version":3,"file":"6.DYxxnkM2.js","sources":["../../../../../../src/routes/v/+page.ts","../../../../../../src/routes/v/+page.svelte"],"sourcesContent":["export const prerender = true;\n\nexport async function load({ url }) {\n\tlet block = url.searchParams.get('block') || undefined;\n\treturn { block };\n}\n","<script lang=\"ts\">\n\timport { onMount } from 'svelte';\n\timport { getFutureBlockDate, Vault } from '@fbch/lib';\n\timport  SeriesIcon from \"$lib/images/SeriesIcon.svelte\"\n\timport { height } from '$lib/store.js';\n\timport { ElectrumClient, ElectrumTransport } from 'electrum-cash';\n\n\texport let data: any;\n\tlet couponAddress: string;\n\tlet vaultAddress: string;\n\t\n\t//@ts-ignore\n\tlet coupons;\n\t//@ts-ignore\n\tlet threads;\n\n\tlet time: number;\n\tif (data.block) {\n\t\ttime = Number(data.block);\n\t\tcouponAddress = Vault.getCoupon(1e8, time);\n\t\tvaultAddress = Vault.getAddress(time);\n\t}\n\n\tlet heightValue: number;\n\n\theight.subscribe((value: any) => {\n\t\theightValue = value;\n\t});\n\n\t// Set up a callback function to handle new blocks.\n\tconst handleCouponNotifications = function (data: any) {\n\t\t//console.log(data);\n\t};\n\t// Set up a callback function to handle new blocks.\n\tconst handleVaultNotifications = function (data: any) {\n\t\t//console.log(data);\n\t};\n\n\tonMount(async () => {\n\t\t// Initialize an electrum client.\n\t\tconst electrum = new ElectrumClient(\n\t\t\t'FBCH',\n\t\t\t'1.4.1',\n\t\t\t'bch.imaginary.cash',\n\t\t\tElectrumTransport.WSS.Port,\n\t\t\tElectrumTransport.WSS.Scheme\n\t\t);\n\n\t\t// Wait for the client to connect\n\t\tawait electrum.connect();\n\t\t// Listen for notifications.\n\t\tawait electrum.subscribe(\n\t\t\thandleCouponNotifications,\n\t\t\t'blockchain.address.subscribe',\n\t\t\tcouponAddress\n\t\t);\n\t\tawait electrum.subscribe(\n\t\t\thandleVaultNotifications,\n\t\t\t'blockchain.address.subscribe',\n\t\t\tvaultAddress\n\t\t);\n\t\tconst vaultResponse = await electrum.request(\n\t\t\t'blockchain.address.listunspent',\n\t\t\tvaultAddress,\n\t\t\t'tokens_only'\n\t\t);\n\t\tif (vaultResponse instanceof Error) throw vaultResponse;\n\t\tthreads = vaultResponse;\n\t\tconst couponResponse = await electrum.request('blockchain.address.listunspent', couponAddress);\n\t\tif (couponResponse instanceof Error) throw couponResponse;\n\t\tcoupons = couponResponse;\n\t\t// @ts-ignore\n\t\tif (coupons.length > 0) coupons.sort((a, b) => parseFloat(b.value) - parseFloat(a.value));\n\t});\n</script>\n\n<svelte:head>\n\t<title>FBCH-{time}</title>\n\t<meta name=\"description\" content=\"Future Vault Series\" />\n\t{#if time > 857000}\n\t<link rel=\"icon\" type=\"image/svg\" href=\"/FBCH-{time}.svg\" />\n\t{/if}\n</svelte:head>\n\n<section>\n\t{#if time}\n\t\t<h2>Vault {time.toLocaleString()}</h2>\n\t\t<SeriesIcon {time} size=300/>\n\t\t<div class=\"cashaddr\">{vaultAddress}</div>\n\t\t\n\t\t{#if heightValue}\n\t\t\t<p>{getFutureBlockDate(heightValue, time).toLocaleDateString()}</p>\n\n\t\t\t{#if time - heightValue < 2000}\n\t\t\t\t<p>{getFutureBlockDate(heightValue, time).toLocaleTimeString()}</p>\n\t\t\t{/if}\n\t\t\t{#if time - heightValue > 0}\n\t\t\t\t<p>T&#8196;-{(time - heightValue).toLocaleString()}&#8196;â–ˆ</p>\n\t\t\t{/if}\n\t\t{/if}\n\t\t\n\t\t<h2>Coupons</h2>\n\n\t\t<p>100M sat placement</p>\n\t\t<div class=\"cashaddr\">{couponAddress}</div>\n\n\t\t{#if coupons && coupons.length}\n\t\t\t\n\t\t\t<table class=\"couponTable\">\n\t\t\t\t<tr class=\"header\">\n\t\t\t\t\t<td>sats </td>\n\t\t\t\t\t<td>spb </td>\n\t\t\t\t\t<td>apr </td>\n\t\t\t\t</tr>\n\t\t\t\t{#each coupons as c}\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"r\">{c.value.toLocaleString()} </td>\n\t\t\t\t\t\t<td class=\"r\">{(c.value / (time - heightValue)).toFixed(1)}</td>\n\t\t\t\t\t\t<td class=\"r\"><i>{(c.value / (time - heightValue) / (1e6 / 52596)).toFixed(2)}%</i></td>\n\t\t\t\t\t</tr>\n\t\t\t\t{/each}\n\t\t\t</table>\n\t\t\t{:else}\n\t\t\t<p>no coupons available</p>\n\t\t{/if}\n\t\t<h2>Threads</h2>\n\n\n\t\t{#if threads && threads.length}\n\t\t\t<table class=\"couponTable\">\n\t\t\t\t<tr class=\"header\">\n\t\t\t\t\t<td>BCH </td>\n\t\t\t\t\t<td>FBCH-{time} </td>\n\t\t\t\t\t<td>Token Id </td>\n\t\t\t\t</tr>\n\t\t\t\t{#each threads as c}\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"r\">{(c.value / 1e8).toFixed(2)} </td>\n\t\t\t\t\t\t<td class=\"r\"><i>{(c.token_data.amount / 1e8).toLocaleString()}</i></td>\n\t\t\t\t\t\t<td class=\"r\"><i>{c.token_data.category.substring(0, 8) + '...' + c.token_data.category.slice(-4)}</i></td>\n\t\t\t\t\t</tr>\n\t\t\t\t{/each}\n\t\t\t</table>\n\t\t{/if}\n\t{/if}\n</section>\n\n<style>\n\tp {\n\t\ttext-overflow: ellipsis;\n\t}\n\n\t.cashaddr {\n\t\tline-break: anywhere;\n\t\tfont-size: small;\n\t}\n\n\t.header td {\n\t\ttext-align: right;\n\t\tfont-style: italic;\n\t}\n\t.r {\n\t\ttext-align: right;\n\t}\n\t.couponTable {\n\t\twidth: 100%;\n\t}\n</style>\n"],"names":["prerender","load","url","ctx","insert_hydration","target","link","anchor","t1_value","create_if_block_3","create_if_block_2","create_if_block_1","h20","div0","h21","div1","h22","current","dirty","set_data","t1","t0_value","getFutureBlockDate","create_if_block_5","create_if_block_4","p","t0","t_value","t","i","table","append_hydration","tr","t4_value","td0","td1","td2","t2","t2_value","t4","i0","i1","if_block0","create_if_block_6","create_if_block","meta","section","data","$$props","couponAddress","vaultAddress","coupons","threads","time","Vault","heightValue","height","value","$$invalidate","handleCouponNotifications","handleVaultNotifications","onMount","electrum","ElectrumClient","ElectrumTransport","vaultResponse","couponResponse","a","b"],"mappings":"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"}
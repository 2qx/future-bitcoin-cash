{"version":3,"file":"6.CGNBnm3t.js","sources":["../../../../../../src/routes/v/+page.ts","../../../../../../src/routes/v/+page.svelte"],"sourcesContent":["export const prerender = true;\n\nexport async function load({ url }) {\n\tlet block = url.searchParams.get('block') || undefined;\n\treturn { block };\n}\n","<script lang=\"ts\">\n\timport { onMount } from 'svelte';\n\timport { getFutureBlockDate, Vault } from '@fbch/lib';\n\timport  SeriesIcon from \"$lib/images/SeriesIcon.svelte\"\n\timport { height } from '$lib/store.js';\n\timport { ElectrumClient, ElectrumTransport } from '@electrum-cash/network';\n\n\texport let data: any;\n\tlet couponAddress: string;\n\tlet vaultAddress: string;\n\t\n\t//@ts-ignore\n\tlet coupons;\n\t//@ts-ignore\n\tlet threads;\n\n\tlet time: number;\n\tif (data.block) {\n\t\ttime = Number(data.block);\n\t\tcouponAddress = Vault.getCoupon(1e8, time);\n\t\tvaultAddress = Vault.getAddress(time);\n\t}\n\n\tlet heightValue: number;\n\n\theight.subscribe((value: any) => {\n\t\theightValue = value;\n\t});\n\n\t// Set up a callback function to handle new blocks.\n\tconst handleCouponNotifications = function (data: any) {\n\t\t//console.log(data);\n\t};\n\t// Set up a callback function to handle new blocks.\n\tconst handleVaultNotifications = function (data: any) {\n\t\t//console.log(data);\n\t};\n\n\tonMount(async () => {\n\t\t// Initialize an electrum client.\n\t\tconst electrum = new ElectrumClient(\n\t\t\t'FBCH',\n\t\t\t'1.4.1',\n\t\t\t'bch.imaginary.cash',\n\t\t\tElectrumTransport.WSS.Port,\n\t\t\tElectrumTransport.WSS.Scheme\n\t\t);\n\n\t\t// Wait for the client to connect\n\t\tawait electrum.connect();\n\t\t// Listen for notifications.\n\t\tawait electrum.subscribe(\n\t\t\thandleCouponNotifications,\n\t\t\t'blockchain.address.subscribe',\n\t\t\tcouponAddress\n\t\t);\n\t\tawait electrum.subscribe(\n\t\t\thandleVaultNotifications,\n\t\t\t'blockchain.address.subscribe',\n\t\t\tvaultAddress\n\t\t);\n\t\tconst vaultResponse = await electrum.request(\n\t\t\t'blockchain.address.listunspent',\n\t\t\tvaultAddress,\n\t\t\t'tokens_only'\n\t\t);\n\t\tif (vaultResponse instanceof Error) throw vaultResponse;\n\t\tthreads = vaultResponse;\n\t\tconst couponResponse = await electrum.request('blockchain.address.listunspent', couponAddress);\n\t\tif (couponResponse instanceof Error) throw couponResponse;\n\t\tcoupons = couponResponse;\n\t\t// @ts-ignore\n\t\tif (coupons.length > 0) coupons.sort((a, b) => parseFloat(b.value) - parseFloat(a.value));\n\t});\n</script>\n\n<svelte:head>\n\t<title>FBCH-{time}</title>\n\t<meta name=\"description\" content=\"Future Vault Series\" />\n\t{#if time > 857000}\n\t<link rel=\"icon\" type=\"image/svg\" href=\"/FBCH-{time}.svg\" />\n\t{/if}\n</svelte:head>\n\n<section>\n\t{#if time}\n\t\t<h2>Vault {time.toLocaleString()}</h2>\n\t\t<SeriesIcon {time} size=300/>\n\t\t<div class=\"cashaddr\">{vaultAddress}</div>\n\t\t\n\t\t{#if heightValue}\n\t\t\t<p>{getFutureBlockDate(heightValue, time).toLocaleDateString()}</p>\n\n\t\t\t{#if time - heightValue < 2000}\n\t\t\t\t<p>{getFutureBlockDate(heightValue, time).toLocaleTimeString()}</p>\n\t\t\t{/if}\n\t\t\t{#if time - heightValue > 0}\n\t\t\t\t<p>T&#8196;-{(time - heightValue).toLocaleString()}&#8196;â–ˆ</p>\n\t\t\t{/if}\n\t\t{/if}\n\t\t\n\t\t<h2>Coupons</h2>\n\t\t{#if coupons}\n\t\t\t{#if coupons.length>0}\n\t\t\t<table class=\"couponTable\">\n\t\t\t\t<tr class=\"header\">\n\t\t\t\t\t<td>series</td>\n\t\t\t\t\t<td>placement </td>\n\t\t\t\t\t<td>coupon </td>\n\t\t\t\t\t<td>spb </td>\n\t\t\t\t\t<td>apr </td>\n\t\t\t\t</tr>\n\t\t\t\t{#each coupons as c}\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"r\">C0</td>\n\t\t\t\t\t\t<td class=\"r\">1 BCH</td>\n\t\t\t\t\t\t<td class=\"r\">{c.value.toLocaleString()} </td>\n\t\t\t\t\t\t<td class=\"r\">{(c.value / (time - heightValue)).toFixed(1)}</td>\n\t\t\t\t\t\t<td class=\"r\"><i>{(c.value / (time - heightValue) / (1e6 / 52596)).toFixed(2)}%</i></td>\n\t\t\t\t\t</tr>\n\t\t\t\t{/each}\n\t\t\t</table>\n\t\t\t{:else}\n\t\t\t<p>no coupons available</p>\n\t\t\t{/if}\n\t\t\t{:else}\n\t\t\t<p>loading coupons...</p>\n\t\t{/if}\n\t\t<h2>Threads</h2>\n\n\n\t\t{#if threads && threads.length}\n\t\t\t<table class=\"couponTable\">\n\t\t\t\t<tr class=\"header\">\n\t\t\t\t\t<td>BCH </td>\n\t\t\t\t\t<td>FBCH-{time} </td>\n\t\t\t\t\t<td>Token Id </td>\n\t\t\t\t</tr>\n\t\t\t\t{#each threads as c}\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td class=\"r\">{(c.value / 1e8).toFixed(2)} </td>\n\t\t\t\t\t\t<td class=\"r\"><i>{(c.token_data.amount / 1e8).toLocaleString()}</i></td>\n\t\t\t\t\t\t<td class=\"r\"><i>{c.token_data.category.substring(0, 8) + '...' + c.token_data.category.slice(-4)}</i></td>\n\t\t\t\t\t</tr>\n\t\t\t\t{/each}\n\t\t\t</table>\n\t\t{:else}\n\t\t<p>loading threads...</p>\n\t\t{/if}\n\t{/if}\n</section>\n\n<style>\n\tp {\n\t\ttext-overflow: ellipsis;\n\t}\n\n\t.cashaddr {\n\t\tline-break: anywhere;\n\t\tfont-size: small;\n\t}\n\n\t.header td {\n\t\ttext-align: right;\n\t\tfont-style: italic;\n\t}\n\t.r {\n\t\ttext-align: right;\n\t}\n\t.couponTable {\n\t\twidth: 100%;\n\t}\n</style>\n"],"names":["prerender","load","url","ctx","insert_hydration","target","link","anchor","t1_value","create_if_block_4","create_if_block_2","create_if_block_1","h20","div","h21","h22","current","dirty","set_data","t1","t0_value","getFutureBlockDate","create_if_block_6","create_if_block_5","p","t0","t_value","t","create_if_block_3","i","table","append_hydration","tr","t8_value","td0","td1","td2","td3","td4","t4","t4_value","t6","t6_value","t8","t2_value","i0","i1","t2","if_block0","create_if_block_7","create_if_block","meta","section","data","$$props","couponAddress","vaultAddress","coupons","threads","time","Vault","heightValue","height","value","$$invalidate","handleCouponNotifications","handleVaultNotifications","onMount","electrum","ElectrumClient","ElectrumTransport","vaultResponse","couponResponse","a","b"],"mappings":"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"}